# Copilot Instructions for Zatrust Quickstart

## Project Overview

This is a minimal, modular Next.js (TypeScript) starter focused on: E2E testability, DRY, SRP, SOLID, low-code patterns, modular structure, and automated maintenance (Dependabot/Renovate + GitHub Actions + Copilot). The goal is to keep the main branch always green and production-ready.

## Tech Stack

- Next.js 15 App Router (TypeScript strict)
- React 19
- Playwright for E2E
- Simple cookie demo auth (replace in prod)
- Docker Dev Container support

## Directory Structure (high level)

```
src/
  app/ (routes, api, pages, layouts)
  components/ (reusable UI + auth components)
  lib/ (utilities)
  middleware.ts (route protection)
.tests / tests/
.github/ (workflows, dependency automation)
```

## Conventions

- Server Components by default; add `"use client"` only when necessary.
- Type-only imports use `import type`.
- Components: concise, single responsibility, composable.
- Avoid repetition: extract shared logic into `lib/` or small components.

## Auth Pattern

- Middleware checks for `demo_user` cookie to guard `/dashboard/*`.
- Login form optionally receives a sanitized `from` param for post-auth redirect.

## Testing

- Playwright E2E covers core auth + navigation flows.
- Use data-testid sparingly; rely on roles and accessible names.
- Keep tests deterministic and independent.

## Automated Maintenance

- Dependabot + Renovate: grouped strategies for stable updates.
- Auto-merge workflow: only minor/patch dependency PRs from trusted bots with proper labels.
- CI matrix (Node LTS + current) ensures forward compatibility.
- CodeQL for code scanning.
- ShellCheck for shell script hygiene.
- Issues auto-created on workflow failures (ci, shellcheck) to trigger Copilot remediation guided by `.prompt.yml`.

## Performance & SEO

- Use Next.js Image and Link optimizations where applicable.
- Keep bundle lean; analyze with `ANALYZE=true next build`.

## Adding Features

1. Create new route under `src/app/<route>/page.tsx`.
2. Prefer server components; introduce client boundary at smallest necessary leaf.
3. Add types for props and extracted utilities.
4. Extend E2E tests to cover new user journey.

## Error Handling

- Provide `error.tsx` at route segment if bespoke recovery is needed.
- Use conventional HTTP status codes in API routes.

## Security & Reliability Notes

- Sanitize redirect sources (only relative internal paths).
- Keep dependencies updated (automation already configured).
- Run `npm run quality:all` before pushing significant changes.
- Principle of Least Privilege in workflows; avoid broad write perms unless needed.

## Remediation Quick Checklist
1. Reproduce locally (`npm run quality:all`).
2. Fix minimal root cause.
3. Add/adjust tests if behavior changes.
4. Re-run quality script until green.
5. Commit with conventional prefix.
6. Reference issue in PR.

## Reference Prompts
- Automation: `.github/instructions/automation.prompt.yml`
- Maintenance: `.github/instructions/maintenance.prompt.yml`
- Policies: `.github/instructions/policies.prompt.yml`
- Context: `.github/instructions/context.prompt.yml`

## Copilot Maintenance Guidance

When Copilot is assigned an issue generated by a failing workflow:

1. Inspect related workflow run logs.
2. Reproduce locally if feasible (run relevant npm script).
3. Propose minimal, targeted fix adhering to project conventions.
4. Update or add tests if behavior changes.
5. Ensure all workflows pass (CI, ShellCheck, CodeQL unaffected).
6. Provide concise PR description referencing issue number and root cause.

## Commit Message Style

- Conventional commits preferred (e.g., `feat:`, `fix:`, `chore: deps:`, `test:`).

## Do / Avoid

- Do: small focused PRs.
- Do: enforce strict types.
- Avoid: large unreviewed rewrites.
- Avoid: introducing stateful global singletons outside Next.js conventions.

## Quick Reference Scripts

- `npm run dev` – Start dev server.
- `npm run quality:all` – Lint + typecheck + E2E tests headless.
- `npm run test:e2e:ui` – Debug E2E interactively.

## Closing Notes

Keep changes incremental and observable. Always leave the codebase healthier than you found it.
